--验证性实验

CREATE TABLE ST(
SNO VARCHAR (10) PRIMARY KEY ,
SNAME VARCHAR(20) NOT NULL, 
DEPT VARCHAR(20), 
AGE INT, 
SEX CHAR(4))
GO
INSERT INTO ST (SNO,SNAME,DEPT) VALUES('1001','ZXX',NULL)
GO
INSERT INTO ST (SNO,SNAME) VALUES('1001','MID')
GO 
INSERT INTO ST (SNO,SNAME) VALUES(NULL,'ZXX')


CREATE TABLE ST2 (
SNO VARCHAR (10) NOT NULL ,
SNAME VARCHAR(20) NOT NULL, 
DEPT VARCHAR(20), 
AGE INT, 
SEX CHAR(4))
GO
INSERT INTO ST2 SELECT * FROM S
GO
ALTER TABLE ST2 ADD CONSTRAINT pk_Sno PRIMARY KEY (SNO)
INSERT INTO ST2 (SNO,SNAME,DEPT) VALUES('200512','Beibei',NULL)


CREATE TABLE CUST(
NO VARCHAR(5) PRIMARY KEY, 
WEIGHT INT DEFAULT(10))
GO
INSERT INTO CUST(NO) VALUES('ZY01')
INSERT INTO CUST(NO) VALUES('ZY03')
INSERT INTO CUST VALUES('ZY02',20) 
GO 
SELECT * FROM CUST


CREATE TABLE CUSTOMER(CUSTNO CHAR(4) NOT NULL CHECK (CUSTNO LIKE 
'[A-Z0-9][A-Z0-9][A-Z0-9][A-Z0-9]'), CUSTNAME VARCHAR(20))
GO
INSERT INTO CUSTOMER VALUES('BJ01','Beijing Grid Corp.')
GO
INSERT INTO CUSTOMER VALUES('BJ1','Beijing Grid Corp.')
GO
INSERT INTO CUSTOMER VALUES('BJ*1','Beijing Grid Corp.')



CREATE TABLE CUST1(
CUSTNO CHAR(4)PRIMARY KEY,
CUSTNAME VARCHAR(20) UNIQUE,
COUNTRY VARCHAR(10))
GO 
INSERT INTO CUST1(CUSTNO) VALUES('BJ01')
GO
INSERT INTO CUST1(CUSTNO) VALUES ('BJ02')
GO
INSERT INTO CUST1 VALUES ('BJ03','Beijing Grid Corp.')
GO
INSERT INTO CUST1 VALUES ('BJ04','Beijing Grid Corp.')



Create table S (
SNO VARCHAR (10) NOT NULL ,
SNAME VARCHAR(20),
DEPT VARCHAR(20), 
AGE INT, SEX CHAR(4) )

Create table C (
CNO VARCHAR(10) NOT NULL, 
CNAME VARCHAR(20),
cpno varchar(10),
credit int)

Create table SC(
SNO VARCHAR(10) NOT NULL, 
CNO VARCHAR(10) NOT NULL, 
SCORE DECIMAL)


ALTER TABLE C ADD CONSTRAINT CpriKEY PRIMARY KEY(CNO)
ALTER TABLE S ADD CONSTRAINT SpriKEY PRIMARY KEY(SNO)
GO
ALTER TABLE SC ADD CONSTRAINT scpriKEY PRIMARY KEY(SNO,CNO)
ALTER TABLE SC ADD CONSTRAINT FK_SC_SNO FOREIGN KEY (SNO) REFERENCES S (SNO)
ALTER TABLE SC ADD CONSTRAINT scforKEY2 FOREIGN KEY (CNO) 
REFERENCES C(CNO)

GO
INSERT INTO SC (SNO,CNO) VALUES('890','C10')
INSERT INTO SC (SNO,CNO) VALUES('200518','C01')
INSERT INTO SC (SNO,CNO) VALUES('890',NULL)
INSERT INTO SC (SNO,CNO) VALUES(NULL,'C10')

select * from SC

INSERT INTO S (SNO, SNAME, DEPT, AGE, SEX) VALUES
('200512', '李勇', '计算机系', 20, '男'),
('200518', '刘晨', '计算机系', 19, '女'),
('200018', '王敏', '数学系', 18, '女'),
('200511', '杨扬', '物理系', 20, '男'),
('200510', '张立', '信息系', 19, '男'),
('200513', '张立', '物理系', 19, '男'),
('200514', '王点点', '信息系', 19, '女'),
('200012', '欧阳雨', '数学系', 20, '男'),
('200515', '刘依依', '数学系', 23, '女');

INSERT INTO C (CNo, CName, Cpno, Credit) VALUES
('c01', '数据库原理', 'c03', 4),
('c02', '信息系统', 'c01', 4),
('c03', '数据结构', null, 6),
('c04', 'DB_设计', 'c01', 3);

INSERT INTO SC (SNo, CNo, Score) VALUES
('200512', 'c02', 70),
('200512', 'c03', null),
('200512', 'c04', null),
('200515', 'c01', 80),
('200518', 'c03', 95),
('200018', 'c01', 80),
('200518', 'c02', 45),
('200511', 'c02', 78),
('200511', 'c01', 45),
('200511', 'c03', 89),
('200514', 'c02', 78),
('200514', 'c01', 45),
('200514', 'c03', 89),
('200514', 'c04', 78);


--设计性实验

--1
-- 设置SNO为主键
ALTER TABLE S
ADD CONSTRAINT PK_S PRIMARY KEY (SNO);

-- 设置SEX的默认值为'女'
ALTER TABLE S
ADD CONSTRAINT DF_S_SEX DEFAULT '女' FOR SEX;


-- 添加AGE的有效值约束
ALTER TABLE S
ADD CONSTRAINT CHK_AGE CHECK (AGE BETWEEN 16 AND 25);


--2
--创建S1表，并设置字段和约束:
CREATE TABLE S1 (
    SNO VARCHAR(10) PRIMARY KEY,
    SNAME VARCHAR(20) NOT NULL,
    DEPT VARCHAR(20),
    AGE INT CHECK (AGE >= 16 AND AGE <= 25),
    SEX CHAR(4) DEFAULT '女'
);
--将S表中的数据插入到S1表中:
INSERT INTO S1 (SNO, SNAME, DEPT, AGE, SEX)
SELECT SNO, SNAME, DEPT, AGE, SEX FROM S;

-- 插入一条年龄小于16的记录
INSERT INTO S1 (SNO, SNAME, DEPT, AGE, SEX) VALUES ('200999', '小明', '计算机系', 15, '男');

-- 插入一条年龄大于25的记录
INSERT INTO S1 (SNO, SNAME, DEPT, AGE, SEX) VALUES ('201000', '小红', '数学系', 30, '女');

--3

CREATE TABLE SC1 (
    SNO VARCHAR(10) NOT NULL,
    CNO VARCHAR(10) NOT NULL,
    SCORE INT,
    PRIMARY KEY (SNO, CNO),
    FOREIGN KEY (SNO) REFERENCES S(SNO),
    FOREIGN KEY (CNO) REFERENCES C(CNO)
);

INSERT INTO SC1 (SNO, CNO, SCORE)
SELECT SNO, CNO, SCORE FROM SC;

-- 插入一条已存在的记录
INSERT INTO SC1 (SNO, CNO, SCORE) VALUES ('200512', 'c02', 80);

-- 插入一条不存在的学生编号记录
INSERT INTO SC1 (SNO, CNO, SCORE) VALUES ('200999', 'c01', 90);

-- 插入一条不存在的课程编号记录
INSERT INTO SC1 (SNO, CNO, SCORE) VALUES ('200512', 'c99', 85);

--4
-- 创建 C1 表
SELECT * INTO C1 FROM C WHERE 1=0; -- 创建空表 C1 与 C 结构相同

-- 插入 C 表中的数据到 C1 表
INSERT INTO C1
SELECT * FROM C;

SELECT * FROM C1;

-- 添加主键约束
ALTER TABLE C1
ADD CONSTRAINT PK_C1 PRIMARY KEY (CNo);

-- 添加外键约束
ALTER TABLE C1
ADD CONSTRAINT FK_C1_CPNO_C1_CNO FOREIGN KEY (Cpno)
REFERENCES C1 (CNo);

-- 添加 CHECK 约束
ALTER TABLE C1
ADD CONSTRAINT CHK_C1_CREDIT CHECK (Credit >= 1 AND Credit <= 6);